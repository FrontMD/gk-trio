// Страница контакты
function contactsController() {

    const contactsBlock = document.querySelector('[data-js="contactsBlock"]')
    
    if(!contactsBlock) return

    // Инициализация карты
    
    const mapContainer = contactsBlock.querySelector('[data-js="contactsMap"]')
    let mapPlacemarks = [...contactsBlock.querySelectorAll('[data-js="contactsTabsTab"]')]
    let map = false

    ymaps.ready(function () {

        let center = mapPlacemarks.length > 0 ? mapPlacemarks[0].dataset.coords.replace(/\s/g,"").split(",") : [52.578441, 39.607545]
        let windowWidth = window.innerWidth
        let zoom = 12;

        if(windowWidth < 768) {
            zoom = 12
        }
    
        map = new ymaps.Map(mapContainer, {
            center: center,
            zoom: zoom,
            controls: []
        });

        let myGeoObjects = []
        
        mapPlacemarks.forEach(placemark => {
            
            let currentPlacemark = new ymaps.Placemark(
                placemark.dataset.coords.replace(/\s/g,"").split(","),
                {},
                {
                    openEmptyBalloon: false,
                    iconLayout: 'default#image',
                    iconImageHref: "data:image/svg+xml,%3Csvg width='867' height='780' viewBox='0 0 867 780' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cg clip-path='url(%23clip0_1701_4456)'%3E%3Cpath d='M383.64 408.3C380.44 405.4 375.14 407.1 374.24 407.5C380.04 418.1 377.84 425.3 372.74 429.5C367.64 433.8 356.94 438.5 364.44 444.4C364.44 444.4 375.34 442.8 383.84 440.5C392.34 438.3 397.04 432.2 394.74 425.3C392.44 418.4 386.84 411.2 383.64 408.3Z' fill='black'/%3E%3Cpath d='M783.51 418.59C778.06 421.1 777.08 427.85 779.14 433.98C781.2 440.11 790.19 444.44 794.4 444.57C798.65 444.79 802.45 451.05 804.91 449.93C810.01 447.6 809.38 442.32 804.91 434.72C800.43 427.12 792.16 430.48 788.05 426.5C783.93 422.52 788.98 416.08 783.53 418.59H783.51Z' fill='black'/%3E%3Cpath d='M129.04 544.4C120.94 547.8 119.64 553.6 122.04 563.4C122.04 563.4 128.04 560 134.04 557.9C140.04 555.8 138.24 548.7 140.64 542C135.64 543.9 137.14 541 129.04 544.4Z' fill='black'/%3E%3Cpath d='M275.8 359.38C276.06 358.48 276.3 357.58 276.5 356.69L277.91 350.53C277.28 353.2 276.56 356.25 275.8 359.38Z' fill='black'/%3E%3Cpath d='M279.72 342.66L279.35 344.26C279.5 343.64 279.62 343.1 279.72 342.66Z' fill='black'/%3E%3Cpath d='M63.2998 362.28C69.9798 362.28 76.0198 363.03 81.3098 364.16C87.1598 279.95 121.71 203.65 175.23 144.96C174.97 142.83 174.75 140.73 174.54 138.67C173.49 128.56 173.4 118.5 174.29 110.36C174.37 109.58 174.47 108.78 174.59 107.95C106.44 173.08 61.8698 262.69 55.0098 362.66H55.0498C57.7898 362.41 60.5698 362.28 63.2998 362.28Z' fill='black'/%3E%3Cpath d='M855.051 400.799C842.971 390.699 827.081 377.369 821.311 364.389C818.811 358.759 808.381 341.239 806.201 327.359C804.981 319.649 810.641 318.579 810.611 306.359C816.231 305.989 820.271 303.209 823.051 295.469C813.491 296.799 809.901 293.579 811.611 284.019C822.201 286.319 851.381 270.849 858.271 236.999C859.831 229.359 823.831 209.799 798.721 218.239C790.261 221.089 783.661 231.009 777.461 226.609C773.951 224.179 777.041 203.019 761.011 188.239C753.941 181.719 739.331 174.679 725.161 173.729C714.681 173.019 704.171 177.829 698.501 177.359C692.661 176.869 679.061 168.379 664.611 169.909C646.381 171.839 626.061 182.969 610.201 170.909C606.851 171.969 601.831 175.279 595.981 180.169C607.681 180.439 629.211 191.719 646.941 192.099C644.551 185.779 662.901 182.369 677.161 184.689C690.321 186.829 701.531 194.479 706.641 194.759C710.611 194.979 715.711 188.769 732.241 189.579C749.831 190.469 773.781 235.799 753.501 216.689C761.131 229.499 775.481 244.509 777.751 246.909C784.851 254.509 797.441 265.669 799.371 276.089C801.611 288.229 793.381 297.059 793.531 314.239C789.901 307.799 788.981 301.179 787.461 292.019C785.661 293.819 785.611 313.729 789.901 326.609C791.981 332.839 800.241 356.969 814.501 376.539C831.931 400.489 856.291 413.909 853.721 420.019C849.251 430.659 835.271 443.469 847.051 451.799C855.941 429.799 854.231 443.529 854.051 452.909C853.901 460.829 848.831 477.019 838.161 474.359C831.951 472.799 820.091 472.319 811.501 473.159C802.721 474.019 788.541 480.019 776.381 482.239C755.391 486.079 744.921 468.229 739.271 463.419C736.721 461.239 732.091 455.839 722.941 455.579C735.721 467.019 732.871 472.099 735.161 477.359C706.791 469.729 691.921 467.939 673.991 460.379C659.391 454.229 646.941 450.059 636.941 442.689C631.641 438.779 594.051 420.469 609.161 345.129C611.761 364.609 617.161 396.259 636.751 408.419C652.751 418.349 683.611 407.129 699.941 395.239C714.601 384.559 743.381 388.469 751.381 377.579C758.701 367.619 761.011 357.429 754.501 347.359C745.821 333.939 732.941 325.129 734.941 305.129C735.501 299.499 737.011 291.569 730.501 274.759C724.191 258.499 695.691 248.739 685.611 252.299C677.691 255.089 660.851 246.779 644.171 236.999C637.501 253.159 624.181 284.149 602.141 290.329C597.381 291.659 590.741 295.449 586.971 296.469C579.491 298.489 570.581 340.209 583.661 386.289C572.671 350.599 567.591 346.279 560.541 293.099C568.341 288.599 578.741 286.499 599.441 280.699C620.141 274.899 633.741 235.199 637.441 227.199C641.141 219.099 644.641 210.099 637.241 208.599C630.041 207.139 620.721 192.239 572.671 187.009C567.671 186.469 565.951 179.699 566.611 179.299C606.051 155.499 617.911 127.179 620.721 106.759C622.791 91.649 624.721 65.869 617.641 63.649C611.491 61.719 602.941 78.469 598.231 90.549C589.091 113.959 574.661 117.229 569.901 119.799C558.151 126.139 538.621 123.049 523.381 124.359C516.631 124.939 506.481 124.889 501.531 125.279C501.531 125.279 499.601 123.799 498.941 123.319C489.311 116.249 477.171 113.099 458.041 111.799C437.341 110.399 410.941 121.399 402.941 125.299C394.941 129.199 391.941 128.399 378.741 126.999C365.541 125.599 347.641 122.299 326.641 121.499C306.131 120.709 293.021 126.299 271.651 144.189C261.951 144.079 248.541 148.329 238.641 148.839C206.941 150.469 208.751 95.669 194.831 97.149C188.751 100.549 187.681 119.949 189.461 137.129C191.131 153.309 192.781 166.649 209.751 183.059C225.731 198.509 235.831 192.389 252.571 208.689C251.351 209.219 250.381 213.129 242.981 216.429C226.911 221.239 199.111 219.749 193.441 220.199C187.041 220.799 188.041 227.099 188.941 230.099C189.741 233.099 189.941 236.999 191.241 245.799C192.441 254.599 200.641 268.399 219.641 282.099C238.641 295.699 246.941 297.799 283.241 295.299C286.501 303.079 283.841 322.539 280.031 341.289C280.031 341.289 280.021 341.339 280.001 341.429V341.449C280.001 341.449 279.971 341.569 279.951 341.649C278.401 349.279 276.651 356.769 275.041 363.299C275.041 363.299 273.031 370.499 272.211 373.539C268.951 385.589 256.421 392.239 252.421 395.949C248.421 399.649 247.101 406.349 246.361 415.489C245.621 424.619 252.751 430.389 257.461 436.689C262.171 442.989 265.161 449.129 265.901 454.759C266.711 460.859 261.361 465.569 259.801 470.339C258.241 475.119 271.611 489.849 271.611 489.849C274.721 493.189 277.671 496.249 279.341 498.399C284.141 504.599 283.741 504.399 297.341 500.899C300.441 507.899 301.441 510.199 306.041 516.999C310.541 523.799 316.841 527.299 333.341 527.799C337.841 548.499 333.341 574.099 327.941 597.699C322.541 621.199 320.111 648.779 353.611 697.579C369.361 720.519 391.191 739.299 410.051 752.739C403.381 752.119 396.771 751.329 390.211 750.359C389.011 749.929 387.581 749.469 385.901 748.989C357.011 740.709 304.541 670.609 301.751 638.609C299.741 615.439 331.531 576.169 322.941 540.909C322.941 540.909 314.511 534.869 306.161 530.799C292.721 524.239 291.831 512.099 291.831 512.099C291.831 512.099 289.161 514.019 282.501 514.909C276.091 515.769 268.731 511.149 259.681 497.429C259.311 496.869 258.941 496.289 258.561 495.699C252.411 486.259 245.651 476.799 245.901 472.389C246.571 460.609 255.561 453.939 253.161 448.389C250.761 442.829 236.271 423.579 238.941 415.129C241.611 406.689 241.881 394.909 253.721 388.739C263.461 383.669 263.851 377.349 267.681 367.059C262.571 367.779 264.071 366.629 256.141 370.399C249.841 363.399 245.541 355.099 234.341 348.099C223.141 341.099 221.241 337.099 194.241 335.199C167.241 333.199 143.741 339.899 127.741 353.599C115.941 363.699 107.041 370.599 97.3408 386.199C97.3408 386.199 81.2408 375.299 56.4408 377.599C31.6408 379.899 8.4408 395.099 2.6408 400.799C-3.1592 406.499 2.1408 412.299 3.9408 416.399C5.7408 420.599 21.1408 448.799 45.6408 452.199C70.1408 455.599 79.9408 449.599 79.9408 449.599C81.5408 462.799 84.8408 474.499 84.5408 483.099C83.9408 498.799 73.7408 521.099 65.4408 534.799C57.2408 548.499 58.0408 574.699 74.0408 589.999C90.0408 605.299 89.2408 600.999 121.341 604.099C153.441 607.199 156.941 604.499 165.941 601.799C174.941 598.999 182.141 594.699 204.841 610.499C214.141 616.999 221.041 633.899 228.541 674.499C229.261 678.399 230.001 682.029 230.761 685.399C222.911 679.729 215.301 673.759 207.941 667.499C191.641 653.799 176.741 638.599 163.141 622.199C158.341 623.499 152.841 624.299 144.341 624.299C140.841 624.299 136.741 624.099 132.141 623.799C156.041 655.499 184.641 683.499 216.841 706.699C280.741 752.699 359.241 779.699 443.941 779.699C474.041 779.699 503.341 776.299 531.541 769.799C531.841 769.699 532.141 769.599 532.441 769.599C536.441 768.599 540.541 767.599 544.541 766.499C664.741 734.499 762.141 646.399 806.941 531.999C798.441 533.399 788.141 534.599 778.341 534.799C762.091 572.269 739.721 606.459 712.511 636.139C724.961 609.239 710.411 573.849 707.681 558.759C703.511 535.709 706.561 519.889 714.341 510.599C734.281 493.359 753.921 504.319 768.571 510.309C783.471 516.409 805.461 513.489 815.161 510.789C824.761 507.989 835.061 495.649 839.161 489.349C843.361 483.049 853.161 489.349 863.051 466.119C865.331 460.769 865.221 449.739 864.941 437.789C864.621 423.919 871.271 414.349 855.051 400.789V400.799ZM667.581 296.349L667.541 296.409C668.031 296.349 668.521 296.329 669.011 296.369C667.161 298.709 665.881 301.579 665.431 304.769C664.071 314.379 670.751 323.259 680.371 324.619C685.571 325.359 690.591 323.729 694.291 320.529C686.081 312.349 684.041 308.099 684.711 303.359C684.801 302.729 685.021 302.129 685.341 301.579C685.901 301.909 686.461 302.229 687.001 302.529C692.461 305.719 696.021 308.459 699.451 312.899C699.591 313.069 699.741 313.269 699.881 313.459C699.971 313.539 700.041 313.639 700.111 313.739C700.301 314.009 700.501 314.299 700.711 314.589C700.841 314.779 700.981 314.969 701.111 315.169C701.381 315.559 701.651 315.969 701.921 316.379C702.071 316.619 702.231 316.849 702.381 317.099C704.331 320.149 706.361 323.879 708.831 328.649C703.891 327.169 702.091 327.069 695.311 327.429C691.491 329.119 682.431 330.219 677.381 329.499C665.861 327.869 656.091 314.399 657.311 305.059C657.411 304.309 657.851 303.339 658.551 302.329C656.251 301.579 653.121 299.889 652.721 296.239C660.571 297.209 667.581 296.349 667.581 296.349ZM194.051 470.339C201.331 470.339 207.241 464.439 207.241 457.159C207.241 452.779 205.101 448.899 201.811 446.509C210.491 448.429 211.601 456.199 211.241 458.999C210.841 462.099 208.341 469.499 201.841 471.499C195.341 473.399 186.341 468.799 182.441 471.899C178.541 475.099 174.241 474.699 174.241 474.699C174.241 474.699 174.371 469.849 176.521 463.769C177.531 460.899 178.991 457.759 181.101 454.729C181.241 454.519 181.391 454.309 181.541 454.099C181.541 454.099 185.731 447.739 194.381 446.349C195.001 448.369 195.481 450.599 195.611 452.579C195.921 457.349 188.771 462.999 183.381 464.889C185.771 468.189 189.661 470.339 194.051 470.339ZM205.461 415.799C196.271 416.389 156.421 424.409 154.051 444.399C151.681 464.389 151.241 476.199 144.721 490.419C138.201 504.639 151.241 525.129 162.501 525.129C173.761 525.129 200.721 527.159 206.641 538.439C210.051 544.939 221.831 548.459 232.721 547.689C220.601 557.349 207.391 562.559 191.041 565.399C171.441 568.799 170.441 573.199 152.941 581.299C135.441 589.399 124.041 587.399 107.941 586.999C91.9408 586.599 87.7408 580.999 80.9408 566.999C74.1408 552.899 79.3408 541.699 89.8408 517.599C100.441 493.399 100.841 478.999 99.7408 468.799C98.6408 458.599 96.7408 444.999 95.7408 427.199C94.7408 409.399 103.841 403.199 119.241 381.799C134.641 360.399 169.041 345.999 199.041 353.099C227.111 359.649 231.191 377.049 235.701 386.719C223.581 406.559 214.771 415.199 205.461 415.799ZM464.751 280.869C462.351 283.749 453.801 288.709 444.121 285.789C425.591 291.119 419.411 286.879 419.011 284.939C419.591 284.709 426.591 280.329 428.651 276.969C429.361 275.799 429.991 274.719 430.591 273.549C430.781 273.189 430.961 272.819 431.141 272.439C431.901 270.849 432.651 268.999 433.501 266.519C434.801 262.709 440.591 255.259 448.631 251.489C448.871 252.639 449.081 253.889 449.271 255.239C451.311 269.769 436.581 272.729 436.471 279.459C438.491 281.109 440.901 282.359 443.601 283.059C453.621 285.649 463.851 279.619 466.441 269.599C468.521 261.559 465.041 253.389 458.411 249.139C470.211 248.459 482.511 250.789 489.301 255.219C485.621 257.479 471.281 257.389 469.131 260.129C471.321 271.649 468.741 276.089 464.751 280.869ZM278.351 266.239C278.351 262.649 279.801 259.389 282.141 257.019C276.041 255.919 273.611 259.129 273.611 259.129C274.221 253.739 283.001 250.689 287.441 253.189C287.671 253.319 287.901 253.439 288.131 253.549C288.611 253.799 289.101 254.029 289.611 254.239C293.691 255.999 298.221 256.789 298.221 256.789C298.221 256.789 297.661 258.739 293.611 259.189C290.471 259.529 288.991 258.709 285.641 257.799C284.581 259.409 283.971 261.349 283.971 263.429C283.971 268.299 287.351 272.379 291.891 273.449C290.591 275.529 289.301 277.459 288.211 278.959C282.541 277.509 278.351 272.369 278.351 266.239ZM382.941 515.099C382.941 515.099 369.941 515.099 357.741 514.099C345.541 513.099 329.041 514.099 329.041 514.099L325.941 499.999C325.941 499.999 328.241 498.399 347.841 496.099C367.441 493.799 391.441 502.099 391.441 502.099L382.941 515.099ZM437.441 435.799C435.741 455.399 423.541 478.099 422.541 483.699C421.541 489.299 416.341 490.899 410.341 490.299C404.341 489.699 363.041 478.299 352.241 474.799C341.441 471.299 340.641 471.099 332.641 473.899C324.541 476.799 299.141 483.599 296.841 485.099C294.541 486.599 289.841 488.799 287.541 486.799C285.241 484.699 280.141 480.999 276.541 477.099C273.041 473.199 285.041 456.799 288.641 449.399C292.241 441.999 277.641 432.199 271.641 426.799C265.741 421.399 263.741 417.199 266.541 409.999C269.341 402.799 281.441 401.699 336.541 400.099C320.541 386.399 293.941 391.899 288.741 388.099C286.261 386.289 287.871 375.209 290.451 363.079C291.451 361.989 292.621 360.359 294.011 358.059C306.701 337.059 313.311 287.209 319.421 265.739C325.531 244.269 309.161 230.319 297.901 226.759C288.741 223.869 274.141 216.919 269.611 203.069C273.631 189.159 280.781 172.539 286.141 164.899C292.941 155.199 310.141 145.699 322.941 141.499C335.741 137.399 381.241 149.599 393.841 148.699C406.441 147.899 406.641 144.199 429.441 137.499C452.141 130.899 452.541 128.599 478.441 138.099C477.841 140.399 477.441 141.399 478.841 157.299C479.161 160.739 479.871 164.239 480.831 167.699C473.881 170.739 462.031 176.889 457.371 185.029C450.611 196.869 424.391 193.489 412.541 200.259C400.701 207.019 382.131 209.899 365.461 257.049C348.781 304.199 365.901 357.279 378.591 366.019C391.281 374.769 419.341 374.489 436.661 397.329C453.171 419.089 459.241 438.539 484.691 427.159C469.641 439.059 452.271 451.869 449.041 452.299C444.541 452.899 444.641 454.999 437.441 435.799ZM509.971 563.399C500.821 575.829 488.721 627.579 488.571 672.669C472.331 613.869 471.341 532.639 509.461 498.489C565.541 448.249 534.961 342.889 533.931 339.389C569.701 441.329 564.201 489.779 509.971 563.399ZM566.591 733.099C556.911 732.879 585.321 682.579 595.831 668.689C615.131 643.289 662.941 628.109 671.241 591.209C674.071 578.649 679.511 564.219 686.221 550.749C685.821 563.579 686.121 578.309 688.421 590.169C693.611 616.839 685.311 642.019 658.051 672.669C632.681 701.199 621.181 708.319 619.801 709.119C619.761 709.139 619.711 709.169 619.671 709.199H619.661C603.421 718.159 586.431 725.899 568.801 732.319C568.071 732.589 567.331 732.859 566.591 733.109V733.099Z' fill='black'/%3E%3Cpath d='M444.86 0C353.69 0 269.83 31.3 203.44 83.73C211.61 87.29 216 96.22 219.34 104.91C281.3 55.79 359.66 26.47 444.86 26.47C499.34 26.47 551.02 38.46 597.41 59.95C604.95 50.07 611.63 48.5 616.63 48.5C618.5 48.5 620.35 48.78 622.13 49.34C632.53 52.61 637.55 62.66 637.68 81.79C670.86 102.6 700.43 128.62 725.26 158.71C725.57 158.72 725.87 158.74 726.17 158.76C744.69 160.01 762.49 169.2 771.18 177.21C771.62 177.62 772.05 178.03 772.47 178.44C703.03 71.06 582.25 0 444.86 0Z' fill='black'/%3E%3C/g%3E%3Cdefs%3E%3CclipPath id='clip0_1701_4456'%3E%3Crect width='866.02' height='779.7' fill='white'/%3E%3C/clipPath%3E%3C/defs%3E%3C/svg%3E%0A",
                    iconImageSize: [30, 30],
                    iconImageOffset: [-15, -15],
                }
            );

            myGeoObjects.push(currentPlacemark)
            
        });

        var clusterer = new ymaps.Clusterer({
            gridSize: 120,
            preset: 'islands#redClusterIcons'
        });

        clusterer.add(myGeoObjects);

        map.geoObjects.add(clusterer);


    });

    // Работа табов
    const tabs = contactsBlock.querySelectorAll('[data-js="contactsTabsTab"]')
    const infoItems = contactsBlock.querySelectorAll('[data-js="contactsInfoItem"]')

    if(tabs.length > 0) {
        tabs.forEach(tab => {
            tab.addEventListener('click', function() {
                contactsSwitch(tab)
            })
        })
    }

    function contactsSwitch(tab) {

        map.setCenter(getCoordsArr(tab.dataset.coords))

        tabs.forEach(item => {
            item.classList.remove('active')
        })

        if(tab.dataset.js == 'contactsTabsTab') {
            tab.classList.add('active')
        } else {
            selectBlock.classList.add('active')
        }

        infoItems.forEach((item, index) => {
            item.classList.remove('active')

            if(index == tab.dataset.id) {
                item.classList.add('active')
            }
        })
    }

    function getCoordsArr(coords) {
        return coords.replace(/\s/g, '').split(',')
    }
}